% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pca_function.R
\name{determine_factors}
\alias{determine_factors}
\title{Determine the Optimal Number of Factors via an Information Criterion}
\usage{
determine_factors(returns, max_m, bandwidth)
}
\arguments{
\item{returns}{A numeric matrix of asset returns with dimensions \eqn{T × p}, where \eqn{T} is the number of observations and \eqn{p} is the number of assets.}

\item{max_m}{Integer. The maximum number of factors to consider.}

\item{bandwidth}{Numeric. The bandwidth used in the kernel weighting for the local PCA.}
}
\value{
A list with two components:
\itemize{
  \item \code{optimal_R}: The optimal number of factors (an integer) that minimizes the information criterion.
  \item \code{IC_values}: A numeric vector of length \code{max_m} containing the information criterion values
        for each candidate number of factors.
}
}
\description{
This function selects the optimal number of factors for a local principal component
analysis (PCA) model of asset returns. It computes an BIC-type information criterion (IC) for each candidate
number of factors, based on the sum of squared residuals (SSR) from the PCA reconstruction and a
penalty term that increases with the number of factors. The optimal number of factors is chosen as the
one that minimizes the IC.
}
\details{
For each candidate number of factors \eqn{R} (from 1 to \code{max_m}), the function:

\enumerate{
  \item Performs a local PCA on the returns at each time point \eqn{r = 1,\dots,T} using \eqn{R} factors.
  \item Computes a reconstruction of the returns and the corresponding residuals:
        \deqn{\text{Residual}_r = R_r - F_r \Lambda_r,}
        where \eqn{R_r} is the return at time \eqn{r}, and \eqn{F_r} and \eqn{\Lambda_r} are the local factors and loadings, respectively.
  \item Computes the average sum of squared residuals (SSR) as:
        \deqn{V(R) = \frac{1}{pT} \sum_{r=1}^{T} \| \text{Residual}_r \|^2.}
  \item Adds a penalty term that increases with \eqn{R}:
        \deqn{\text{Penalty}(R) = R × \frac{(p + T × \text{bandwidth})}{(pT × \text{bandwidth})} \log\left(\frac{pT × \text{bandwidth}}{(p + T × \text{bandwidth})}\right).}
  \item The information criterion is defined as:
        \deqn{\text{IC}(R) = \log\big(V(R)\big) + \text{Penalty}(R).}
}

The optimal number of factors is then chosen as the value of \eqn{R} that minimizes \eqn{\text{IC}(R)}.
}
\examples{
\dontrun{
# Simulate a returns matrix with 200 observations and 10 assets
set.seed(123)
returns <- matrix(rnorm(200 * 10), nrow = 200, ncol = 10)

# Determine the optimal number of factors (up to 5) using a specified bandwidth.
result <- determine_factors(returns, max_m = 5, bandwidth = 0.2)
print(result$optimal_R)
print(result$IC_values)
}

}
